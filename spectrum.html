<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Audio Spectrum Analyzer</title>
  <style>
    canvas {
      width: 100%;
      height: 200px;
      background: black;
    }
    button {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <canvas id="spectrum" width="800" height="200"></canvas>
  <br />
  <button onclick="start()">Start</button>
  <button onclick="stop()">Stop</button>

  <script>
    let audioContext;
    let analyser;
    let microphone;
    let animationId;

    async function start() {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      audioContext = new (window.AudioContext || window.webkitAudioContext)();
      analyser = audioContext.createAnalyser();
      analyser.fftSize = 2048;

      const source = audioContext.createMediaStreamSource(stream);
      source.connect(analyser);

      drawSpectrum();
    }

function drawSpectrum() {
  const canvas = document.getElementById("spectrum");
  const canvasCtx = canvas.getContext("2d");
  const bufferLength = analyser.frequencyBinCount;
  const dataArray = new Uint8Array(bufferLength);

  function draw() {
    animationId = requestAnimationFrame(draw);
    analyser.getByteFrequencyData(dataArray);

    canvasCtx.fillStyle = "black";
    canvasCtx.fillRect(0, 0, canvas.width, canvas.height);

    const barWidth = (canvas.width / bufferLength) * 2.5;
    let x = 0;

    for (let i = 0; i < bufferLength; i++) {
      const barHeight = dataArray[i];
      canvasCtx.fillStyle = `rgb(${barHeight + 100}, 50, 50)`;
      canvasCtx.fillRect(x, canvas.height - barHeight / 2, barWidth, barHeight / 2);
      x += barWidth + 1;
    }

    // Detect dominant frequency and note
    const freq = getDominantFrequency(analyser, audioContext);
    const note = frequencyToNote(freq);

    // Draw note text
    canvasCtx.fillStyle = "white";
    canvasCtx.font = "20px Arial";
    canvasCtx.fillText(`Note: ${note} (${freq.toFixed(1)} Hz)`, 10, 30);
  }

  draw();
}

    function stop() {
      if (audioContext) {
        audioContext.close();
      }
      cancelAnimationFrame(animationId);
    }

    function getDominantFrequency(analyser, audioContext) {
  const bufferLength = analyser.frequencyBinCount;
  const dataArray = new Uint8Array(bufferLength);
  analyser.getByteFrequencyData(dataArray);

  // Find the index of the loudest frequency bin
  let maxVal = -Infinity;
  let maxIndex = -1;
  for (let i = 0; i < bufferLength; i++) {
    if (dataArray[i] > maxVal) {
      maxVal = dataArray[i];
      maxIndex = i;
    }
  }

  // Convert index to frequency
  const nyquist = audioContext.sampleRate / 2;
  const freq = (maxIndex / bufferLength) * nyquist;
  return freq;
}


function frequencyToNote(freq) {
  const noteNames = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];
  const A4 = 440;
  const semitone = 12;
  const noteNumber = Math.round(semitone * Math.log2(freq / A4)) + 69;
  const noteIndex = noteNumber % 12;
  const octave = Math.floor(noteNumber / 12) - 1;
  const noteName = noteNames[noteIndex];
  return `${noteName}${octave}`;
}



  </script>
</body>
</html>
